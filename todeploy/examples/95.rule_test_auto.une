#==================================================================================================================================
# This example is a Test-bench for AFTER and WITHIN
#
# ---------------------------------------------------------------------------------------------------------------------------------
# This file is part of the Mingle project, which is licensed under Apache 2.0 License
#
# @author : Francisco José Morero Peyrona
# @project: https://github.com/peyrona/mingle
#==================================================================================================================================

DEVICE console
    DRIVER OutputDriver


DEVICE clock
    DRIVER ClockDriver
        CONFIG
            interval = 1s


# DEVICE timeCounter
#     DRIVER CellSetDriver
#         CONFIG
#             value = 0


# DEVICE ruleCounter
#     DRIVER CellSetDriver
#         CONFIG
#             value = 0


# DEVICE cell_1
#     DRIVER CellSetDriver
#         CONFIG
#             value = 0


# DEVICE cell_2
#     DRIVER CellSetDriver
#         CONFIG
#             value = 0

#===================================================================================================================================

# WHEN clock > 0                         # Every 1 second
# THEN timeCounter = timeCounter + 1     # timeCounter is incremented in 1
#      console = "["+ time() +"] Cell_1="+ cell_1 +" , Cell_2="+ cell_2


# WHEN timeCounter == 3    # After 3 secs
# THEN cell_1 = 3
#      cell_2 = 9

#-------------------------------- TESTING AFTER         FUNCIONA

# WHEN cell_1 == 3
# THEN ruleCounter = ruleCounter + 1
#      console SET "Cell_1: is 3 after 5 secs"    # This message is printed ...
# IF cell_1 == 3 AFTER 5s                         # 5 secs after this rule was evaluated for the 1st time

#------------------------------- TESTING WITHIN         FUNCIONA

# WHEN cell_2 == 0
# THEN ruleCounter = ruleCounter + 1
#      console = "Cell_2: did not change its value throughout 2 seconds"
# IF cell_2 == 0 WITHIN 3s


# WHEN cell_2 == 9
# THEN ruleCounter = ruleCounter + 1
#      console = "Cell_2: After having value 9, it did not change throughout 3 secs"
# IF cell_2 == 9 WITHIN 3s

#------------------------------- TESTING AFTER & WITHIN

WHEN clock >= 3000 #cell_1 == 3 && cell_2 == 9
THEN console = clock #"Tested AFTER and WITHIN: simple"   #ruleCounter = ruleCounter + 1
IF   (clock > 4000 AFTER 2s)
# (clock > 4500 WITHIN 2s)  #  (cell_1 == 3 AFTER .5s) && int( cell_1 AFTER 1m ) #&& (cell_2 == 9 WITHIN 4s)    # ¡REMEMBER! it is mandatory to group the futures using parenthesis


# WHEN cell_1 >= 0 || cell_2 >= 0
# THEN ruleCounter = ruleCounter + 1
#      console = "Tested AFTER and WITHIN: more complex"
# IF ((cell_1 == 0 AFTER 3s) || (cell_1 == 3 AFTER 5s)) \
#    && \
#    ((cell_2 == 0 WITHIN 2s) || (cell_2 == 9 WITHIN 3s))

#------------------------------- EXITING AFTER SUCCESS

# WHEN ruleCounter == 5
# THEN OnSuccess


# SCRIPT OnSuccess
#     LANGUAGE java
#     FROM {
#             System.out.println( "All RULEs were evaluated successfully" );
#             rt.exit( 0,0 );
#          }

# >>>>>>>>>>>>>> EOF <<<<<<<<<<<<<<<<